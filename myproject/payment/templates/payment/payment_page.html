{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оплата замовлення | PrometeyLabs</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Підключення власних стилів -->
    <link rel="stylesheet" href="{% static 'payment/css/style.css' %}">
</head>
<body>
    <div class="container">
        <!-- Логотип -->
        <div class="logo">
            <div class="logo-text">PrometeyLabs</div>
        </div>

        <h1>Деталі вашого замовлення</h1>

        {% if expires_at_iso %}
            <div id="countdown-timer">Часу на оплату залишилось: <span id="timer"></span></div>
        {% endif %}

        <div class="info-section payment-details">
            <h2>Інформація про платіж</h2>
            <p><strong>Опис:</strong> {{ payment_link.description }}</p>
            <p><strong>Сума до сплати:</strong> {{ payment_link.amount }} {{ payment_link.currency }}</p>
            <p>
                <strong>Статус:</strong> 
                {% if payment_link.status == 'pending' %}
                    <span class="status-badge status-pending">{{ payment_link.get_status_display }}</span>
                {% elif payment_link.status == 'paid' %}
                    <span class="status-badge status-paid">{{ payment_link.get_status_display }}</span>
                {% elif payment_link.status == 'expired' %}
                    <span class="status-badge status-expired">{{ payment_link.get_status_display }}</span>
                {% elif payment_link.status == 'cancelled' %}
                    <span class="status-badge status-cancelled">{{ payment_link.get_status_display }}</span>
                {% else %}
                    <span class="status-badge">{{ payment_link.get_status_display }}</span>
                {% endif %}
            </p>
            {% if payment_link.expires_at %}
            <p>
                <strong>Дійсне до:</strong> 
                <span class="expires-date">{{ payment_link.expires_at|date:"d.m.Y" }}</span> 
                <span class="expires-time">{{ payment_link.expires_at|date:"H:i" }}</span>
                <span class="expires-timezone">({{ payment_link.expires_at|date:"T" }})</span>
            </p>
            {% endif %}
        </div>

        <div class="info-section company-info">
            <h2>Інформація про компанію</h2>
            <div class="company-description">
                <p>PrometeyLabs — це українська ІТ-компанія, що спеціалізується на швидкій розробці вебпродуктів, автоматизації процесів, інтеграції ШІ та чат-ботів. Ми працюємо швидко, без зайвих витрат та з фокусом на якість.</p>
                
                <div class="toggle-btn-wrapper">
                    <button class="toggle-details-btn" id="companyDetailsBtn">Детальніше</button>
                </div>
                
                <div class="company-details" id="companyDetails">
                    <p><strong>Основні напрямки:</strong><br>
                    Розробка сайтів та платформ<br>
                    AI-аватари, чат-боти, телеграм-боти<br>
                    E-commerce рішення</p>
                    
                    <p class="company-legal-info">ФОП Дмитренко Софія Дмитрівна, зареєстровано в Україні, платник єдиного податку 3 групи.</p>
                </div>
            </div>
        </div>

        <div class="info-section payment-instructions">
            <h2>Інструкції з оплати</h2>
            <div>
                <ol>
                    <li>Ознайомтеся з деталями замовлення та сумою до оплати.</li>
                    <li>Перегляньте договір і завантажте його для власної документації.</li>
                    <li>Скористайтеся одним із наведених нижче способів оплати:
                        <ul>
                            <li><strong>Банківський переказ:</strong> Використовуйте реквізити, вказані в розділі "Форма оплати". Ви можете скопіювати необхідні дані натиснувши відповідні кнопки.</li>
                            <li><strong>Платіжна картка:</strong> Натисніть кнопку "Оплатити" для переходу на безпечну сторінку обробки платежів.</li>
                        </ul>
                    </li>
                    <li>Після здійснення оплати вам буде надіслано підтвердження на вашу електронну пошту.</li>
                    <li>Якщо у вас виникли складнощі з оплатою, зверніться за контактними даними, вказаними в розділі з договором.</li>
                </ol>
                <p><em>Зверніть увагу: для юридичних осіб та ФОП при оплаті важливо вказати правильне призначення платежу.</em></p>
            </div>
        </div>

        {% if payment_link.contract_file %}
        <div class="info-section contract-link">
            <h2>Договір</h2>
            <p>Усі послуги надаються відповідно до публічного договору, який доступний для ознайомлення на сторінці перед оплатою. Оплата є підтвердженням вашої згоди з умовами договору.</p>
            <p><b>Якщо у вас виникли питання щодо умов договору, зв'яжіться з нами до здійснення оплати.</b></p>
            
            <div class="contact-info">
                <p><strong>Контакти для звернень</strong></p>
                <p>З усіх питань, пов'язаних з оплатою, прохання звертатися на електронну адресу:</p>
                <p><a href="mailto:prometeylabs@gmail.com" class="contact-email">prometeylabs@gmail.com</a></p>
                <p>або</p>
                <p><a href="https://t.me/PrometeyLabs" target="_blank" class="telegram-button">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 8px;">
                        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM16.64 8.8C16.49 10.38 15.84 14.22 15.51 15.99C15.37 16.74 15.09 16.99 14.83 17.02C14.25 17.07 13.81 16.64 13.25 16.27C12.37 15.69 11.87 15.33 11.02 14.77C10.03 14.12 10.67 13.76 11.24 13.18C11.39 13.03 13.95 10.7 14 10.49C14.0069 10.4582 14.006 10.4252 13.9973 10.3938C13.9886 10.3624 13.9724 10.3337 13.95 10.31C13.89 10.26 13.81 10.28 13.74 10.29C13.65 10.31 12.15 11.34 9.24 13.39C8.78 13.71 8.37 13.86 8 13.85C7.58 13.84 6.79 13.62 6.2 13.43C5.47 13.21 4.89 13.09 4.95 12.7C4.98 12.5 5.27 12.29 5.82 12.09C8.94 10.67 11.07 9.72 12.21 9.22C15.33 7.8 16.13 7.54 16.64 7.54C16.75 7.54 16.99 7.57 17.15 7.7C17.29 7.82 17.32 7.97 17.33 8.08C17.33 8.17 17.35 8.44 17.34 8.67L16.64 8.8Z" fill="currentColor"/>
                    </svg>
                    Telegram
                </a></p>
            </div>
            
            <div class="download-btn-wrapper">
                <a href="{{ payment_link.contract_file.url }}" target="_blank" class="button button-secondary download-contract-btn">Завантажити договір (PDF)</a>
            </div>
        </div>
        {% endif %}

        <div class="info-section payment-form">
            <h2>Форма оплати</h2>
            
            <div class="payment-requisites">
                <h3>Реквізити для оплати</h3>
                
                <div class="requisites-grid">
                    <div class="requisites-field">
                        <div class="requisites-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z" fill="#555555"/>
                            </svg>
                        </div>
                        <div class="requisites-content">
                            <label>ФОП</label>
                            <span><strong>Дмитренко Софія Дмитрівна</strong></span>
                        </div>
                        <button class="copy-btn" data-copy="Дмитренко Софія Дмитрівна">Копіювати</button>
                    </div>
                    
                    <div class="requisites-field">
                        <div class="requisites-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 4H4C2.89 4 2.01 4.89 2.01 6L2 18C2 19.11 2.89 20 4 20H20C21.11 20 22 19.11 22 18V6C22 4.89 21.11 4 20 4ZM20 18H4V12H20V18ZM20 8H4V6H20V8Z" fill="#555555"/>
                            </svg>
                        </div>
                        <div class="requisites-content">
                            <label>ІПН</label>
                            <span><strong>3770706565</strong></span>
                        </div>
                        <button class="copy-btn" data-copy="3770706565">Копіювати</button>
                    </div>
                    
                    <div class="requisites-field">
                        <div class="requisites-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6.5 10H4.5V17H6.5V10ZM12.5 10H10.5V17H12.5V10ZM21 4H3C1.9 4 1 4.9 1 6V8H3V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V8H23V6C23 4.9 22.1 4 21 4ZM19 19H5V8H19V19ZM18.5 10H16.5V17H18.5V10Z" fill="#555555"/>
                            </svg>
                        </div>
                        <div class="requisites-content">
                            <label>IBAN</label>
                            <span><strong>UA633220010000026003350084660</strong></span>
                        </div>
                        <button class="copy-btn" data-copy="UA633220010000026003350084660">Копіювати</button>
                    </div>
                    
                    <div class="requisites-field bank-details">
                        <div class="requisites-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 10H6V17H4V10ZM10 10H12V17H10V10ZM2 22H21V19H2V22ZM16 10H18V17H16V10ZM11.5 1L2 6V8H21V6L11.5 1Z" fill="#555555"/>
                            </svg>
                        </div>
                        <div class="requisites-content">
                            <label>Банк</label>
                            <span>Акціонерне товариство УНІВЕРСАЛ БАНК, МФО: 322001</span>
                        </div>
                    </div>
                    
                    <div class="requisites-field payment-purpose">
                        <div class="requisites-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14 2H6C4.9 2 4.01 2.9 4.01 4L4 20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM16 18H8V16H16V18ZM16 14H8V12H16V14ZM13 9V3.5L18.5 9H13Z" fill="#555555"/>
                            </svg>
                        </div>
                        <div class="requisites-content">
                            <label>Призначення платежу</label>
                            <span><strong>Оплата за {{ payment_link.description }}</strong></span>
                        </div>
                        <button class="copy-btn" data-copy="Оплата за {{ payment_link.description }}">Копіювати</button>
                    </div>
                </div>
            </div>
            
            <div class="payment-action">
                <p>Оберіть спосіб оплати:</p>
                <a href="#" class="button button-primary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 8px;">
                    <path d="M20 4H4C2.89 4 2.01 4.89 2.01 6L2 18C2 19.11 2.89 20 4 20H20C21.11 20 22 19.11 22 18V6C22 4.89 21.11 4 20 4ZM20 18H4V12H20V18ZM20 8H4V6H20V8Z" fill="currentColor"/>
                </svg>Оплатити {{ payment_link.amount }} {{ payment_link.currency }}</a>
            </div>
        </div>

        <div class="footer">
            <p><small>Унікальний ID посилання: {{ payment_link.unique_id }}</small></p>
            <p><small>&copy; 2025 PrometeyLabs. Всі права захищено.</small></p>
        </div>
    </div>

    {% if expires_at_iso %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const countDownDate = new Date("{{ expires_at_iso }}").getTime();
            const timerElement = document.getElementById("timer");
            const timerContainer = document.getElementById("countdown-timer");

            if (!timerElement) return;

            // Перевіряємо час одразу при завантаженні сторінки
            checkTimeRemaining();
            
            // Функція для перевірки і оновлення часу
            function checkTimeRemaining() {
                const now = new Date().getTime();
                const distance = countDownDate - now;
                
                if (distance < 0) {
                    // Час вже минув
                    timerElement.innerHTML = "ЧАС ВИЙШОВ";
                    timerContainer.classList.add('timer-expired');
                    // Можливо тут додати перезавантаження сторінки або інші дії
                    return;
                }
                
                // Розрахунок часу, що залишився
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Форматування тексту таймера
                let timerText = "";
                if (days > 0) timerText += days + " д " + (days === 1 ? "" : "");
                if (hours > 0 || days > 0) timerText += hours + " год " + (hours === 1 ? "" : "");
                if (minutes > 0 || hours > 0 || days > 0) timerText += minutes + " хв " + (minutes === 1 ? "" : "");
                timerText += seconds + " с";
                
                timerElement.innerHTML = timerText;
                
                // Змінюємо колір таймера в залежності від того, скільки часу залишилось
                if (distance < 1000 * 60 * 30) { // Менше 30 хвилин
                    timerContainer.classList.add('timer-urgent');
                } else if (distance < 1000 * 60 * 60 * 3) { // Менше 3 годин
                    timerContainer.classList.add('timer-warning');
                }
            }

            // Оновлення таймера кожну секунду
            const x = setInterval(function() {
                const now = new Date().getTime();
                const distance = countDownDate - now;

                if (distance < 0) {
                    clearInterval(x);
                    checkTimeRemaining();
                } else {
                    checkTimeRemaining();
                }
            }, 1000);
        });
    </script>
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Додаємо функціонал кнопкам копіювання
            const copyButtons = document.querySelectorAll('.copy-btn');
            
            copyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const textToCopy = this.getAttribute('data-copy');
                    navigator.clipboard.writeText(textToCopy)
                        .then(() => {
                            // Зміна тексту кнопки на підтвердження
                            const originalText = this.innerText;
                            this.innerText = 'Скопійовано!';
                            this.classList.add('copy-success');
                            
                            // Повернення оригінального тексту через 2 секунди
                            setTimeout(() => {
                                this.innerText = originalText;
                                this.classList.remove('copy-success');
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Помилка копіювання: ', err);
                        });
                });
            });
            
            // Функціонал для розгортання деталей про компанію
            const companyDetailsBtn = document.getElementById('companyDetailsBtn');
            const companyDetails = document.getElementById('companyDetails');
            
            if (companyDetailsBtn && companyDetails) {
                companyDetailsBtn.addEventListener('click', function() {
                    const btnWrapper = this.parentElement; // Отримуємо wrapper для кнопки
                    const companyDescriptionDiv = btnWrapper.parentElement; // Отримуємо батьківський div
                    
                    companyDetails.classList.toggle('visible');
                    this.classList.toggle('active');
                    
                    if (companyDetails.classList.contains('visible')) {
                        // Якщо блок розгорнутий, переміщуємо кнопку в кінець
                        this.textContent = 'Згорнути';
                        btnWrapper.classList.add('bottom');
                        companyDescriptionDiv.appendChild(btnWrapper);
                    } else {
                        // Якщо блок згорнутий, повертаємо кнопку після першого абзацу
                        this.textContent = 'Детальніше';
                        btnWrapper.classList.remove('bottom');
                        companyDescriptionDiv.insertBefore(btnWrapper, companyDetails);
                    }
                });
            }
        });
    </script>
</body>
</html> 