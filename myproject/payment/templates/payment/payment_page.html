{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оплата замовлення | PrometeyLabs</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Підключення власних стилів -->
    <link rel="stylesheet" href="{% static 'payment/css/style.css' %}">
</head>
<body>
    <div class="container">
        <!-- Логотип -->
        <div class="logo">
            <div class="logo-text">PrometeyLabs</div>
        </div>

        <h1>Деталі вашого замовлення</h1>

        {% if expires_at_iso %}
            <div id="countdown-timer">Часу на оплату залишилось: <span id="timer"></span></div>
        {% endif %}

        <div class="info-section payment-details">
            <h2>Інформація про платіж</h2>
            <p><strong>Опис:</strong> {{ payment_link.description }}</p>
            <p><strong>Сума до сплати:</strong> {{ payment_link.amount }} {{ payment_link.currency }}</p>
            <p>
                <strong>Статус:</strong> 
                {% if payment_link.status == 'pending' %}
                    <span class="status-badge status-pending">{{ payment_link.get_status_display }}</span>
                {% elif payment_link.status == 'paid' %}
                    <span class="status-badge status-paid">{{ payment_link.get_status_display }}</span>
                {% elif payment_link.status == 'expired' %}
                    <span class="status-badge status-expired">{{ payment_link.get_status_display }}</span>
                {% elif payment_link.status == 'cancelled' %}
                    <span class="status-badge status-cancelled">{{ payment_link.get_status_display }}</span>
                {% else %}
                    <span class="status-badge">{{ payment_link.get_status_display }}</span>
                {% endif %}
            </p>
            {% if payment_link.expires_at %}
            <p>
                <strong>Дійсне до:</strong> 
                <span class="expires-date">{{ payment_link.expires_at|date:"d.m.Y" }}</span> 
                <span class="expires-time">{{ payment_link.expires_at|date:"H:i" }}</span>
                <span class="expires-timezone">({{ payment_link.expires_at|date:"T" }})</span>
            </p>
            {% endif %}
        </div>

        <div class="info-section company-info">
            <h2>Інформація про компанію</h2>
            <div class="company-description">
                <p>PrometeyLabs — це українська ІТ-компанія, що спеціалізується на швидкій розробці вебпродуктів, автоматизації процесів, інтеграції ШІ та чат-ботів. Ми працюємо швидко, без зайвих витрат та з фокусом на якість.</p>
                
                <p><strong>Основні напрямки:</strong><br>
                Розробка сайтів та платформ<br>
                AI-аватари, чат-боти, телеграм-боти<br>
                E-commerce рішення</p>
                
                <p>ФОП Дмитренко Софія Дмитрівна, зареєстровано в Україні, платник єдиного податку 3 групи.</p>
            </div>
        </div>

        <div class="info-section payment-instructions">
            <h2>Інструкції з оплати</h2>
            <div>
                <ol>
                    <li>Ознайомтеся з деталями замовлення та сумою до оплати.</li>
                    <li>Перегляньте договір і завантажте його для власної документації.</li>
                    <li>Скористайтеся одним із наведених нижче способів оплати:
                        <ul>
                            <li><strong>Банківський переказ:</strong> Використовуйте реквізити, вказані в розділі "Форма оплати". Ви можете скопіювати необхідні дані натиснувши відповідні кнопки.</li>
                            <li><strong>Платіжна картка:</strong> Натисніть кнопку "Оплатити" для переходу на безпечну сторінку обробки платежів.</li>
                        </ul>
                    </li>
                    <li>Після здійснення оплати вам буде надіслано підтвердження на вашу електронну пошту.</li>
                    <li>Якщо у вас виникли складнощі з оплатою, зверніться за контактними даними, вказаними в розділі з договором.</li>
                </ol>
                <p><em>Зверніть увагу: для юридичних осіб та ФОП при оплаті важливо вказати правильне призначення платежу.</em></p>
            </div>
        </div>

        {% if payment_link.contract_file %}
        <div class="info-section contract-link">
            <h2>Договір</h2>
            <p>Усі послуги надаються відповідно до публічного договору, який доступний для ознайомлення на сторінці перед оплатою. Оплата є підтвердженням вашої згоди з умовами договору.</p>
            <p><b>Якщо у вас виникли питання щодо умов договору, зв'яжіться з нами до здійснення оплати.</b></p>
            
            <div class="contact-info">
                <p><strong>Контакти для звернень</strong><br>
                З усіх питань, пов'язаних з оплатою, прохання звертатися на електронну адресу: <a href="mailto:prometeylabs@gmail.com">prometeylabs@gmail.com</a><br>
                або в telegram <a href="https://t.me/PrometeyLabs" target="_blank">@PrometeyLabs</a></p>
            </div>
            
            <p><a href="{{ payment_link.contract_file.url }}" target="_blank" class="button button-secondary">Завантажити договір (PDF)</a></p>
        </div>
        {% endif %}

        <div class="info-section payment-form">
            <h2>Форма оплати</h2>
            
            <p><strong>Реквізити для оплати:</strong></p>
            
            <div class="requisites-field">
                <span>ФОП <strong>Дмитренко Софія Дмитрівна</strong></span>
                <button class="copy-btn" data-copy="Дмитренко Софія Дмитрівна">Копіювати</button>
            </div>
            
            <div class="requisites-field">
                <span>ІПН: <strong>3770706565</strong></span>
                <button class="copy-btn" data-copy="3770706565">Копіювати</button>
            </div>
            
            <div class="requisites-field">
                <span>IBAN: <strong>UA633220010000026003350084660</strong></span>
                <button class="copy-btn" data-copy="UA633220010000026003350084660">Копіювати</button>
            </div>
            
            <div class="requisites-field">
                <span>Акціонерне товариство УНІВЕРСАЛ БАНК, МФО: 322001</span>
            </div>
            
            <div class="requisites-field">
                <span>Призначення платежу: <strong>Оплата за {{ payment_link.description }}</strong></span>
                <button class="copy-btn" data-copy="Оплата за {{ payment_link.description }}">Копіювати</button>
            </div>
            
            <p><em>(Тут буде інтеграція з платіжною системою)</em></p>
            <!-- Заглушка для кнопки оплати -->
            <a href="#" class="button button-primary">Оплатити {{ payment_link.amount }} {{ payment_link.currency }}</a>
        </div>

        <div class="footer">
            <p><small>Унікальний ID посилання: {{ payment_link.unique_id }}</small></p>
            <p><small>&copy; 2025 PrometeyLabs. Всі права захищено.</small></p>
        </div>
    </div>

    {% if expires_at_iso %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const countDownDate = new Date("{{ expires_at_iso }}").getTime();
            const timerElement = document.getElementById("timer");
            const timerContainer = document.getElementById("countdown-timer");

            if (!timerElement) return;

            // Перевіряємо час одразу при завантаженні сторінки
            checkTimeRemaining();
            
            // Функція для перевірки і оновлення часу
            function checkTimeRemaining() {
                const now = new Date().getTime();
                const distance = countDownDate - now;
                
                if (distance < 0) {
                    // Час вже минув
                    timerElement.innerHTML = "ЧАС ВИЙШОВ";
                    timerContainer.classList.add('timer-expired');
                    // Можливо тут додати перезавантаження сторінки або інші дії
                    return;
                }
                
                // Розрахунок часу, що залишився
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Форматування тексту таймера
                let timerText = "";
                if (days > 0) timerText += days + " д " + (days === 1 ? "" : "");
                if (hours > 0 || days > 0) timerText += hours + " год " + (hours === 1 ? "" : "");
                if (minutes > 0 || hours > 0 || days > 0) timerText += minutes + " хв " + (minutes === 1 ? "" : "");
                timerText += seconds + " с";
                
                timerElement.innerHTML = timerText;
                
                // Змінюємо колір таймера в залежності від того, скільки часу залишилось
                if (distance < 1000 * 60 * 30) { // Менше 30 хвилин
                    timerContainer.classList.add('timer-urgent');
                } else if (distance < 1000 * 60 * 60 * 3) { // Менше 3 годин
                    timerContainer.classList.add('timer-warning');
                }
            }

            // Оновлення таймера кожну секунду
            const x = setInterval(function() {
                const now = new Date().getTime();
                const distance = countDownDate - now;

                if (distance < 0) {
                    clearInterval(x);
                    checkTimeRemaining();
                } else {
                    checkTimeRemaining();
                }
            }, 1000);
        });
    </script>
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Додаємо функціонал кнопкам копіювання
            const copyButtons = document.querySelectorAll('.copy-btn');
            
            copyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const textToCopy = this.getAttribute('data-copy');
                    navigator.clipboard.writeText(textToCopy)
                        .then(() => {
                            // Зміна тексту кнопки на підтвердження
                            const originalText = this.innerText;
                            this.innerText = 'Скопійовано!';
                            this.classList.add('copy-success');
                            
                            // Повернення оригінального тексту через 2 секунди
                            setTimeout(() => {
                                this.innerText = originalText;
                                this.classList.remove('copy-success');
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Помилка копіювання: ', err);
                        });
                });
            });
        });
    </script>
</body>
</html> 